name: Issue Management
permissions:
  issues: write
  contents: read

on:
  issues:
    types: [opened, labeled]
  issue_comment:
    types: [created]

jobs:
  welcome-new-issues:
    if: github.event.action == 'opened'
    runs-on: ubuntu-latest
    steps:
      - name: Welcome new issue
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ğŸ‘‹ æ„Ÿè°¢æ‚¨æäº¤issueï¼

            æˆ‘ä»¬å·²ç»æ”¶åˆ°æ‚¨çš„åé¦ˆï¼Œç»´æŠ¤è€…ä¼šå°½å¿«æŸ¥çœ‹å¹¶å›å¤ã€‚

            åœ¨ç­‰å¾…å›å¤æœŸé—´ï¼Œæ‚¨å¯ä»¥ï¼š
            - ğŸ“– æŸ¥çœ‹[é¡¹ç›®æ–‡æ¡£](https://github.com/lamina-dev/Lamina/wiki)
            - ğŸ’¬ åŠ å…¥[QQäº¤æµç¾¤](https://qm.qq.com/q/QwPXCgsJea) è¿›è¡Œå®æ—¶è®¨è®º
            - ğŸ” æœç´¢[ç°æœ‰issues](https://github.com/lamina-dev/Lamina/issues) çœ‹æ˜¯å¦æœ‰ç±»ä¼¼é—®é¢˜

            å¦‚æœè¿™æ˜¯æ‚¨çš„ç¬¬ä¸€æ¬¡è´¡çŒ®ï¼Œæ¬¢è¿é˜…è¯»æˆ‘ä»¬çš„[è´¡çŒ®æŒ‡å—](https://github.com/lamina-dev/Lamina/blob/main/docs/zh_CN/CONTRIBUTING.md)ã€‚

  auto-assign-labels:
    if: github.event.action == 'opened'
    runs-on: ubuntu-latest
    steps:
      - name: Auto assign labels
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issue = context.payload.issue;
            const title = issue.title.toLowerCase();
            const body = issue.body || '';
            const labels = [];
            // æ ¹æ®æ ‡é¢˜å’Œå†…å®¹è‡ªåŠ¨æ·»åŠ æ ‡ç­¾
            if (title.includes('bug') || title.includes('é”™è¯¯') || title.includes('é—®é¢˜')) labels.push('bug');
            if (title.includes('feature') || title.includes('åŠŸèƒ½') || title.includes('ç‰¹æ€§')) labels.push('enhancement');
            if (title.includes('docs') || title.includes('æ–‡æ¡£') || title.includes('documentation')) labels.push('documentation');
            if (title.includes('help') || title.includes('å¸®åŠ©') || title.includes('é—®é¢˜')) labels.push('question');
            // æ ¹æ®å†…å®¹åˆ¤æ–­ä¼˜å…ˆçº§
            if (body.includes('ç´§æ€¥') || body.includes('urgent') || body.includes('critical')) labels.push('priority:high');
            // æ ¹æ®å†…å®¹åˆ¤æ–­éš¾åº¦
            if (body.includes('good first issue') || title.includes('ç®€å•')) labels.push('good first issue');
            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: labels
              });
            }

  handle-help-wanted:
    if: contains(github.event.issue.labels.*.name, 'question')
    runs-on: ubuntu-latest
    steps:
      - name: Add help resources
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

            è¿™é‡Œæœ‰ä¸€äº›å¯èƒ½å¯¹æ‚¨æœ‰ç”¨çš„èµ„æºï¼š

            ğŸ“š **æ–‡æ¡£èµ„æº**
            - [è¯­æ³•æŒ‡å—](https://github.com/lamina-dev/Lamina/wiki)
            - [ç¼–è¯‘æŒ‡å—](https://github.com/Lamina-dev/Lamina/blob/main/docs/zh_CN/Compile.md)
            - [æ’ä»¶å¼€å‘æŒ‡å—](https://github.com/Lamina-dev/Lamina/blob/main/docs/zh_CN/PLUGIN_GUIDE.md)

            ğŸ” **å¸¸è§é—®é¢˜**
            - æœç´¢[å·²å…³é—­çš„issues](https://github.com/lamina-dev/Lamina/issues?q=is%3Aissue+is%3Aclosed)
            - æŸ¥çœ‹[ç¤ºä¾‹ä»£ç ](https://github.com/lamina-dev/Lamina/tree/main/examples)

            ğŸ’¬ **å³æ—¶å¸®åŠ©**
            - åŠ å…¥QQç¾¤ï¼šhttps://qm.qq.com/q/QwPXCgsJea

            å¦‚æœä»¥ä¸Šèµ„æºæ— æ³•è§£å†³æ‚¨çš„é—®é¢˜ï¼Œè¯·æä¾›æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¼šå°½å¿«ä¸ºæ‚¨è§£ç­”ï¼

  stale-issues:
    if: github.event.action == 'opened'
    runs-on: ubuntu-latest
    steps:
      - name: Mark stale issues
        uses: actions/stale@v8
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          stale-issue-message: |
            è¿™ä¸ªissueå·²ç»30å¤©æ²¡æœ‰æ´»åŠ¨äº†ã€‚

            å¦‚æœè¿™ä¸ªé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·å›å¤æ­¤è¯„è®ºè¯´æ˜å½“å‰çŠ¶æ€ã€‚
            å¦åˆ™ï¼Œè¿™ä¸ªissueå°†åœ¨7å¤©åè‡ªåŠ¨å…³é—­ã€‚

            æ‚¨å¯ä»¥éšæ—¶é‡æ–°æ‰“å¼€å·²å…³é—­çš„issueã€‚
          stale-pr-message: |
            è¿™ä¸ªPRå·²ç»30å¤©æ²¡æœ‰æ´»åŠ¨äº†ã€‚

            å¦‚æœæ‚¨ä»åœ¨å¤„ç†è¿™ä¸ªPRï¼Œè¯·å›å¤æ­¤è¯„è®ºã€‚
            å¦åˆ™ï¼Œè¿™ä¸ªPRå°†åœ¨7å¤©åè‡ªåŠ¨å…³é—­ã€‚
          days-before-stale: 30
          days-before-close: 7
          stale-issue-label: "stale"
          stale-pr-label: "stale"
          exempt-issue-labels: "pinned,enhancement,priority:high"
          exempt-pr-labels: "pinned,priority:high"
