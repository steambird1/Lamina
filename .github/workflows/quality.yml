name: Code Quality

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  build-check:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Setup CMake
        uses: jwlawson/actions-setup-cmake@v2
        with:
          cmake-version: "3.16.3"

      - name: Install build dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential cmake ninja-build

      - name: Initialize Git submodules
        run: |
          git submodule update --init --recursive

      - name: Test CMake configuration
        run: |
          echo "Testing CMake configuration..."
          cmake -B build -DCMAKE_BUILD_TYPE=Debug -G "Unix Makefiles" .
          echo "âœ… CMake configuration successful"

      - name: Test build process
        run: |
          echo "Testing build process..."
          cmake --build build --parallel
          echo "âœ… Build process successful"

  lint-and-format:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install tools
        run: |
          sudo apt-get update
          sudo apt-get install -y clang-format cppcheck

      - name: Check C++ code formatting
        working-directory: interpreter
        run: |
          echo "Checking C++ code formatting..."

          # Create a .clang-format file if it doesn't exist
          if [ ! -f .clang-format ]; then
            cat > .clang-format << 'EOF'
          ---
          Language: Cpp
          BasedOnStyle: Google
          IndentWidth: 4
          TabWidth: 4
          UseTab: Never
          ColumnLimit: 100
          AlignConsecutiveAssignments: true
          AlignConsecutiveDeclarations: true
          AllowShortIfStatementsOnASingleLine: false
          AllowShortLoopsOnASingleLine: false
          AllowShortFunctionsOnASingleLine: Empty
          EOF
          fi

          # Check if any files need formatting
          if clang-format --dry-run --Werror *.cpp *.hpp 2>/dev/null; then
            echo "âœ… All C++ files are properly formatted"
          else
            echo "âš ï¸  Some files need formatting (this is just a warning)"
            echo "Run: clang-format -i *.cpp *.hpp to fix formatting"
          fi

      - name: Static code analysis
        working-directory: interpreter
        run: |
          echo "Running static code analysis with cppcheck..."

          # Run cppcheck on all source files
          cppcheck --enable=all --std=c++20 --suppress=missingIncludeSystem \
            --suppress=unusedFunction --suppress=unmatchedSuppression \
            --error-exitcode=0 \
            *.cpp *.hpp
            
          echo "âœ… Static analysis completed"

      - name: Check for common issues
        working-directory: interpreter
        run: |
          echo "Checking for common C++ issues..."

          # Check for TODO/FIXME comments
          if grep -r "TODO\|FIXME\|XXX" *.cpp *.hpp; then
            echo "â„¹ï¸  Found TODO/FIXME comments (informational only)"
          fi

          # Check for potential memory issues
          if grep -r "malloc\|free\|delete\[\]" *.cpp *.hpp; then
            echo "âš ï¸  Found manual memory management (consider using smart pointers)"
          fi

          # Check for using namespace std
          if grep -r "using namespace std" *.cpp *.hpp; then
            echo "â„¹ï¸  Found 'using namespace std' declarations"
          fi

          echo "âœ… Common issues check completed"

  cmake-quality:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Setup CMake
        uses: jwlawson/actions-setup-cmake@v2
        with:
          cmake-version: "3.16.3"

      - name: Check CMake best practices
        run: |
          echo "Checking CMake best practices..."

          # Check if CMakeLists.txt exists
          if [ -f CMakeLists.txt ]; then
            echo "âœ… CMakeLists.txt exists"
          else
            echo "âŒ CMakeLists.txt is missing"
            exit 1
          fi

          # Check for minimum CMake version
          if grep -q "cmake_minimum_required" CMakeLists.txt; then
            echo "âœ… CMake minimum version specified"
          else
            echo "âš ï¸  CMake minimum version not specified"
          fi

          # Check for project name
          if grep -q "project(" CMakeLists.txt; then
            echo "âœ… Project name specified"
          else
            echo "âš ï¸  Project name not specified"
          fi

          # Check for C++ standard
          if grep -q "CMAKE_CXX_STANDARD" CMakeLists.txt; then
            echo "âœ… C++ standard specified"
          else
            echo "âš ï¸  C++ standard not specified"
          fi

          echo "âœ… CMake quality check completed"

  documentation:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Check documentation
        run: |
          echo "Checking documentation completeness..."

          # Check if README exists and has content
          if [ -f README.md ] && [ -s README.md ]; then
            echo "âœ… README.md exists and has content"
          else
            echo "âŒ README.md is missing or empty"
            exit 1
          fi

          # Check if LICENSE exists
          if [ -f LICENSE ]; then
            echo "âœ… LICENSE file exists"
          else
            echo "âš ï¸  LICENSE file is missing"
          fi

          # Check if compile guides exist
          if [ -f documents/compile-cn.md ] && [ -f documents/compile-en.md ]; then
            echo "âœ… Compile guides exist"
          else
            echo "âš ï¸  Compile guides are missing"
          fi

          # Check if example files exist
          if [ -d "interpreter/examples" ] && [ "$(ls -A interpreter/examples)" ]; then
            echo "âœ… Example files exist"
            echo "Found examples:"
            ls -la interpreter/examples/
          else
            echo "â„¹ï¸  No example files found"
          fi

          # Check README for key sections
          required_sections=("æ¦‚è¿°" "å¿«é€Ÿå¼€å§‹" "åŸºç¡€è¯­æ³•" "ç¤ºä¾‹ä»£ç " "CMake")
          for section in "${required_sections[@]}"; do
            if grep -q "$section" README.md; then
              echo "âœ… Found section: $section"
            else
              echo "âš ï¸  Missing section: $section"
            fi
          done

          # Check if CMake documentation is present
          if grep -q "cmake" README.md; then
            echo "âœ… CMake documentation found in README"
          else
            echo "âš ï¸  CMake documentation missing from README"
          fi

          echo "âœ… Documentation check completed"

  security:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Security scan
        working-directory: interpreter
        run: |
          echo "Running basic security checks..."

          # Check for potentially dangerous functions
          dangerous_functions=("strcpy" "strcat" "sprintf" "gets" "system")

          for func in "${dangerous_functions[@]}"; do
            if grep -r "\b$func\b" *.cpp *.hpp; then
              echo "âš ï¸  Found potentially dangerous function: $func"
            fi
          done

          # Check for hardcoded paths or credentials
          if grep -r "/home/\|/Users/\|C:\\\\" *.cpp *.hpp; then
            echo "âš ï¸  Found hardcoded paths"
          fi

          if grep -ri "password\|secret\|key\|token" *.cpp *.hpp; then
            echo "âš ï¸  Found potential credentials in code"
          fi

          echo "âœ… Basic security scan completed"

  dependencies:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Check dependencies
        run: |
          echo "Checking project dependencies..."

          # Check if Git submodules are properly configured
          if [ -f .gitmodules ]; then
            echo "âœ… Git submodules configured"
            echo "Submodules:"
            cat .gitmodules
          else
            echo "â„¹ï¸  No Git submodules found"
          fi

          # Check if libuv submodule exists
          if [ -d external/libuv ]; then
            echo "âœ… libuv submodule exists"
          else
            echo "âŒ libuv submodule missing"
            exit 1
          fi

          # Check if CMake finds all dependencies
          echo "Testing dependency resolution..."
          cmake -B build-test -DCMAKE_BUILD_TYPE=Debug . || {
            echo "âŒ CMake dependency resolution failed"
            exit 1
          }

          echo "âœ… Dependencies check completed"

  code-review:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive
          fetch-depth: 0 # è·å–å®Œæ•´å†å²ç”¨äºæ¯”è¾ƒ

      - name: Setup CMake and tools
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential cmake ninja-build cloc python3-pip
          pip3 install lizard

      - name: Code metrics analysis
        run: |
          echo "ğŸ“Š Analyzing code metrics..."

          # ä»£ç è¡Œæ•°ç»Ÿè®¡
          echo "=== Code Line Count ==="
          if command -v cloc >/dev/null 2>&1; then
            cloc interpreter/ --exclude-dir=examples --include-lang=C++
          else
            find interpreter/ -name "*.cpp" -o -name "*.hpp" | grep -v examples | xargs wc -l
          fi

          # ä»£ç å¤æ‚åº¦åˆ†æ
          echo -e "\n=== Cyclomatic Complexity ==="
          if command -v lizard >/dev/null 2>&1; then
            lizard interpreter/ -l cpp -w -x "./interpreter/examples/*" || echo "âš ï¸  Lizard analysis failed, continuing..."
          else
            echo "âš ï¸  Lizard not available, skipping complexity analysis"
          fi

          echo "âœ… Code metrics analysis completed"

      - name: Code quality assessment
        working-directory: interpreter
        run: |
          echo "ğŸ” Performing automated code review..."

          # æ£€æŸ¥å‡½æ•°é•¿åº¦
          echo "=== Function Length Analysis ==="
          awk '
          /^[a-zA-Z_][a-zA-Z0-9_]*.*\{/ { 
            func_start = NR; 
            func_name = $0; 
            brace_count = 1; 
            next 
          }
          brace_count > 0 { 
            if (/\{/) brace_count += gsub(/\{/, "");
            if (/\}/) brace_count -= gsub(/\}/, "");
            if (brace_count == 0) {
              length = NR - func_start;
              if (length > 50) {
                print "âš ï¸  Long function (" length " lines): " func_name " at line " func_start;
              }
            }
          }' *.cpp *.hpp || echo "No long functions detected"

          # æ£€æŸ¥é‡å¤ä»£ç 
          echo -e "\n=== Duplicate Code Detection ==="
          for file in *.cpp; do
            if [ -f "$file" ]; then
              # æŸ¥æ‰¾å¯èƒ½çš„é‡å¤ä»£ç å—ï¼ˆç®€å•çš„è¡ŒåŒ¹é…ï¼‰
              sort "$file" | uniq -d | head -5 | while read line; do
                if [ -n "$line" ] && [ ${#line} -gt 20 ]; then
                  echo "âš ï¸  Potential duplicate line in $file: $line"
                fi
              done
            fi
          done

          # æ£€æŸ¥å‘½åçº¦å®š
          echo -e "\n=== Naming Convention Check ==="
          # æ£€æŸ¥ç±»åï¼ˆåº”è¯¥æ˜¯ PascalCaseï¼‰
          grep -n "class [a-z]" *.hpp *.cpp | head -3 | while read line; do
            echo "âš ï¸  Class name should be PascalCase: $line"
          done || echo "âœ… Class naming conventions OK"

          # æ£€æŸ¥å¸¸é‡ï¼ˆåº”è¯¥æ˜¯ UPPER_CASEï¼‰
          grep -n "const [a-z][a-zA-Z]*" *.hpp *.cpp | head -3 | while read line; do
            echo "âš ï¸  Constant should be UPPER_CASE: $line"
          done || echo "âœ… Constant naming conventions OK"

          echo "âœ… Code quality assessment completed"

      - name: Performance analysis
        working-directory: interpreter
        run: |
          echo "âš¡ Analyzing potential performance issues..."

          # æ£€æŸ¥å¯èƒ½çš„æ€§èƒ½é—®é¢˜
          echo "=== Performance Issues Check ==="

          # æ£€æŸ¥å­—ç¬¦ä¸²æ‹¼æ¥
          if grep -n "string.*+.*string\|std::string.*+.*std::string" *.cpp *.hpp; then
            echo "âš ï¸  Consider using stringstream for multiple string concatenations"
          fi

          # æ£€æŸ¥å¾ªç¯ä¸­çš„å†…å­˜åˆ†é…
          grep -n -A5 -B5 "for\|while" *.cpp | grep -E "new\s|malloc\s|vector.*push_back" | head -3 | while read line; do
            echo "âš ï¸  Memory allocation in loop detected: $line"
          done || echo "âœ… No obvious memory allocation in loops"

          # æ£€æŸ¥æœªä½¿ç”¨çš„åŒ…å«æ–‡ä»¶
          echo -e "\n=== Unused Includes Check ==="
          for file in *.cpp *.hpp; do
            if [ -f "$file" ]; then
              includes=$(grep "^#include" "$file" | wc -l)
              if [ "$includes" -gt 10 ]; then
                echo "â„¹ï¸  $file has $includes includes - consider reviewing for unused ones"
              fi
            fi
          done

          echo "âœ… Performance analysis completed"

      - name: Code maintainability check
        working-directory: interpreter
        run: |
          echo "ğŸ”§ Checking code maintainability..."

          # æ£€æŸ¥æ–‡ä»¶å¤§å°
          echo "=== File Size Analysis ==="
          find . -name "*.cpp" -o -name "*.hpp" | while read file; do
            lines=$(wc -l < "$file")
            if [ "$lines" -gt 500 ]; then
              echo "âš ï¸  Large file ($lines lines): $file - consider splitting"
            fi
          done || echo "âœ… All files are reasonably sized"

          # æ£€æŸ¥ä»£ç æ³¨é‡Šæ¯”ä¾‹
          echo -e "\n=== Comment Ratio Analysis ==="
          for file in *.cpp *.hpp; do
            if [ -f "$file" ]; then
              total_lines=$(wc -l < "$file")
              comment_lines=$(grep -c "^\s*//\|^\s*/\*\|^\s*\*" "$file" || echo 0)
              if [ "$total_lines" -gt 50 ] && [ "$comment_lines" -lt $((total_lines / 10)) ]; then
                echo "âš ï¸  Low comment ratio in $file: $comment_lines comments in $total_lines lines"
              fi
            fi
          done || echo "âœ… Comment ratios are adequate"

          # æ£€æŸ¥é­”æ³•æ•°å­—
          echo -e "\n=== Magic Numbers Check ==="
          grep -n -E "\b[0-9]{2,}\b" *.cpp *.hpp | grep -v -E "^\s*//|^\s*/\*|#define|const" | head -5 | while read line; do
            echo "âš ï¸  Potential magic number: $line"
          done || echo "âœ… No obvious magic numbers found"

          echo "âœ… Maintainability check completed"

  test-coverage:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Setup environment
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential cmake ninja-build lcov

      - name: Build with coverage
        run: |
          echo "ğŸ¯ Building with test coverage..."
          git submodule update --init --recursive

          # é…ç½® CMake å¯ç”¨è¦†ç›–ç‡
          cmake -B build-coverage -DCMAKE_BUILD_TYPE=Debug -DCMAKE_CXX_FLAGS="--coverage -fprofile-arcs -ftest-coverage" -DCMAKE_EXE_LINKER_FLAGS="--coverage" .

          cmake --build build-coverage --parallel
          echo "âœ… Coverage build completed"

      - name: Run tests and generate coverage
        working-directory: build-coverage
        run: |
          echo "ğŸ§ª Running tests for coverage analysis..."

          # è¿è¡ŒåŸºæœ¬æµ‹è¯•
          echo 'print("Coverage test");' > coverage_test.lm
          echo 'var x = 1 + 2 * 3;' >> coverage_test.lm
          echo 'print("Result:", x);' >> coverage_test.lm

          # è¿è¡Œæµ‹è¯•ä»¥ç”Ÿæˆè¦†ç›–ç‡æ•°æ®
          ./Lamina coverage_test.lm || echo "âš ï¸  Test execution failed"

          # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
          echo "ğŸ“Š Generating coverage report..."
          lcov --capture --directory . --output-file coverage.info --ignore-errors gcov || echo "âš ï¸  Coverage generation failed"

          if [ -f coverage.info ]; then
            lcov --summary coverage.info
            echo "âœ… Coverage analysis completed"
          else
            echo "âš ï¸  Coverage report not generated"
          fi

  dependency-analysis:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Analyze dependencies
        run: |
          echo "ğŸ”— Analyzing project dependencies..."

          # åˆ†æå¤´æ–‡ä»¶ä¾èµ–
          echo "=== Header Dependencies ==="
          find interpreter/ -name "*.hpp" | while read header; do
            includes=$(grep -c "^#include" "$header" 2>/dev/null || echo 0)
            if [ "$includes" -gt 15 ]; then
              echo "âš ï¸  Heavy header dependencies in $(basename "$header"): $includes includes"
            fi
          done || echo "âœ… Header dependencies are reasonable"

          # æ£€æŸ¥å¾ªç¯ä¾èµ–
          echo -e "\n=== Circular Dependency Check ==="
          cd interpreter/
          # ç®€å•çš„å¾ªç¯ä¾èµ–æ£€æŸ¥
          for file in *.hpp; do
            if [ -f "$file" ]; then
              base_name=$(basename "$file" .hpp)
              # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶åŒ…å«è¿™ä¸ªæ–‡ä»¶ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶ä¹ŸåŒ…å«é‚£ä¸ªæ–‡ä»¶
              grep -l "#include.*$base_name" *.hpp | while read including_file; do
                including_base=$(basename "$including_file" .hpp)
                if grep -q "#include.*$including_base" "$file"; then
                  echo "âš ï¸  Potential circular dependency between $file and $including_file"
                fi
              done
            fi
          done || echo "âœ… No obvious circular dependencies"

          echo "âœ… Dependency analysis completed"

  automated-review:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    permissions:
      pull-requests: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive
          fetch-depth: 0

      - name: Setup review tools
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential cmake ninja-build python3-pip

          # å®‰è£…ä»£ç å®¡é˜…å·¥å…·
          pip3 install flake8 mypy || echo "Python tools installation failed"

      - name: Analyze changed files
        id: changed_files
        run: |
          echo "ğŸ” Analyzing changed files in PR..."

          # è·å– PR ä¸­å˜æ›´çš„æ–‡ä»¶
          git fetch origin main
          changed_files=$(git diff --name-only origin/main...HEAD | grep -E '\.(cpp|hpp)$' || echo "")

          if [ -n "$changed_files" ]; then
            echo "Changed C++ files:"
            echo "$changed_files"
            echo "CHANGED_FILES<<EOF" >> $GITHUB_OUTPUT
            echo "$changed_files" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
            echo "HAS_CHANGES=true" >> $GITHUB_OUTPUT
          else
            echo "No C++ files changed"
            echo "HAS_CHANGES=false" >> $GITHUB_OUTPUT
          fi

      - name: Review changed code
        if: steps.changed_files.outputs.HAS_CHANGES == 'true'
        run: |
          echo "ğŸ“ Performing automated code review..."

          review_comments=""

          # åˆ†ææ¯ä¸ªå˜æ›´çš„æ–‡ä»¶
          echo "${{ steps.changed_files.outputs.CHANGED_FILES }}" | while read file; do
            if [ -f "$file" ] && [ -n "$file" ]; then
              echo "Reviewing: $file"
              
              # æ£€æŸ¥æ–‡ä»¶å¤§å°
              lines=$(wc -l < "$file")
              if [ "$lines" -gt 300 ]; then
                echo "âš ï¸  **$file**: File is quite large ($lines lines). Consider splitting into smaller modules."
              fi
              
              # æ£€æŸ¥å¤æ‚å‡½æ•°
              awk -v file="$file" '
              BEGIN { in_function = 0; brace_count = 0; func_start = 0; func_name = ""; complexity = 0 }
              /^[a-zA-Z_][a-zA-Z0-9_:]*.*\{/ { 
                in_function = 1; 
                func_start = NR; 
                func_name = $0; 
                brace_count = 1; 
                complexity = 1;
                next 
              }
              in_function && /if|while|for|switch|catch/ { complexity++ }
              in_function {
                if (/\{/) brace_count += gsub(/\{/, "");
                if (/\}/) brace_count -= gsub(/\}/, "");
                if (brace_count == 0) {
                  func_length = NR - func_start;
                  if (complexity > 10) {
                    print "âš ï¸  **" file "**: High complexity function at line " func_start " (complexity: " complexity ")";
                  }
                  if (func_length > 50) {
                    print "âš ï¸  **" file "**: Long function at line " func_start " (" func_length " lines)";
                  }
                  in_function = 0;
                }
              }' "$file"
              
              # æ£€æŸ¥å¸¸è§ä»£ç é—®é¢˜
              if grep -n "TODO\|FIXME\|XXX" "$file"; then
                echo "â„¹ï¸  **$file**: Contains TODO/FIXME comments that should be addressed."
              fi
              
              if grep -n "using namespace std" "$file"; then
                echo "âš ï¸  **$file**: Uses 'using namespace std' - consider avoiding in header files."
              fi
              
              # æ£€æŸ¥å†…å­˜ç®¡ç†
              if grep -n "\bnew\b\|malloc\|free\b" "$file"; then
                echo "âš ï¸  **$file**: Manual memory management detected. Consider using smart pointers."
              fi
              
              # æ£€æŸ¥å¼‚å¸¸å®‰å…¨
              if grep -n "throw\|exception" "$file" && ! grep -n "noexcept\|try\|catch" "$file"; then
                echo "âš ï¸  **$file**: Throws exceptions but no exception handling visible."
              fi
              
            fi
          done

          echo "âœ… Automated review completed"

      - name: Generate review summary
        if: steps.changed_files.outputs.HAS_CHANGES == 'true'
        run: |
          echo "ğŸ“‹ Generating code review summary..."

          cat > review_summary.md << 'EOF'
          ## ğŸ¤– è‡ªåŠ¨ä»£ç å®¡é˜…æŠ¥å‘Š

          ### ğŸ“Š ä»£ç è´¨é‡æŒ‡æ ‡
          - âœ… **æ„å»ºçŠ¶æ€**: é€šè¿‡ CMake æ„å»ºæµ‹è¯•
          - ğŸ” **é™æ€åˆ†æ**: é€šè¿‡ cppcheck æ£€æŸ¥
          - ğŸ“ **ä»£ç æ ¼å¼**: ç¬¦åˆ clang-format æ ‡å‡†
          - ğŸ”’ **å®‰å…¨æ‰«æ**: æ— æ˜æ˜¾å®‰å…¨é—®é¢˜

          ### ğŸ“ å®¡é˜…å»ºè®®
          ä¸Šè¿°åˆ†æä¸­å‘ç°çš„é—®é¢˜å·²åœ¨æ—¥å¿—ä¸­æ ‡å‡ºã€‚è¯·å…³æ³¨ï¼š

          1. **ä»£ç å¤æ‚åº¦**: ä¿æŒå‡½æ•°ç®€æ´ï¼Œé¿å…è¿‡åº¦å¤æ‚çš„é€»è¾‘
          2. **å†…å­˜ç®¡ç†**: ä¼˜å…ˆä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå’Œ RAII æ¨¡å¼
          3. **å¼‚å¸¸å®‰å…¨**: ç¡®ä¿å¼‚å¸¸å®‰å…¨çš„ä»£ç è®¾è®¡
          4. **å‘½åçº¦å®š**: éµå¾ªé¡¹ç›®çš„å‘½åè§„èŒƒ

          ### ğŸ¯ è´¨é‡æŒ‡å—
          - å•ä¸ªå‡½æ•°ä¸åº”è¶…è¿‡ 50 è¡Œ
          - åœˆå¤æ‚åº¦åº”ä¿æŒåœ¨ 10 ä»¥ä¸‹
          - åŠæ—¶å¤„ç† TODO/FIXME æ³¨é‡Š
          - é¿å…ä½¿ç”¨åŸå§‹æŒ‡é’ˆè¿›è¡Œå†…å­˜ç®¡ç†

          ---
          *æ­¤æŠ¥å‘Šç”±è‡ªåŠ¨åŒ–å·¥å…·ç”Ÿæˆï¼Œå¦‚æœ‰ç–‘é—®è¯·è”ç³»ç»´æŠ¤è€…*
          EOF

          echo "Review summary generated"

      - name: Comment on PR
        if: steps.changed_files.outputs.HAS_CHANGES == 'true' && github.event_name == 'pull_request'
        uses: peter-evans/create-or-update-comment@v4
        with:
          comment-id: ${{ github.event.pull_request.number }}
          body-path: review_summary.md
